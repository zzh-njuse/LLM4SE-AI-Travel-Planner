# Web 版 AI 旅行规划师（需求规格说明书）

> 说明：本文件基于用户提供的原始需求（Web 版 AI 旅行规划师），用于作为项目的详细需求规格（MUST / SHOULD / COULD），便于开发、测试与验收。

---

## 假设与范围说明

- 项目名称（临时）：Web 版 AI 旅行规划师（AI Travel Planner）。
- 平台：响应式 Web 应用（桌面 + 平板 + 手机）。前端单页应用（如 React/Vue），后端提供 REST/GraphQL API 并可与 Supabase / Firebase / 自建后端配合。
- 语音识别、地图、LMM（大语言模型）等使用第三方 API（例如：科大讯飞、高德/百度地图、OpenAI/其他 LLM 提供者）。API key 不应写入公开代码库，用户在运行时通过配置页面或环境变量提供。
- 交付物按提交要求：GitHub 仓库 + README + Docker 镜像（以及可用的 API key 说明，若非使用助教提供 key，则用户需在 README 中提供可用 key 并保证 3 个月可用）。
- 本文档为需求规格（非设计稿或实现细节），包括功能与非功能需求、验收标准与初步时间表。

---

## 执行摘要

目标：构建一个 Web 版 AI 旅行规划师，用户可通过语音或文字描述旅行需求，系统基于 LLM 与第三方地图/服务自动生成个性化行程，并支持预算管理、行程云同步与多设备访问。成功标准包括：核心功能（智能行程生成、语音输入、预算管理、用户账户与云同步）可用；UI 在主流设备上响应式且流畅；部署在 Docker 容器并在 GitHub 有完整提交记录与 README。

---

## 合同（简短）

- 输入：用户通过语音或文字提交的旅行请求（目的地、时间、预算、人数、偏好等）；用户上传/填写的 API key（在设置中）。
- 输出：结构化行程（含交通、住宿、景点、餐厅、时间表、预算分配）、费用记录/预算报告。导出/分享为可选功能（参见“非必须（可选）”章节）。
- 错误模式：API 调用失败（语音/地图/LLM）、用户输入不完整、鉴权失败、超出预算或无法满足偏好。系统应提供可理解的错误提示与回退方案（如降级到文本输入、提示联系助教/客服）。

---

## 用户画像与关键场景（User Personas）

1. 个体游客（如：20–35 岁，喜欢自由行，使用手机）
   - 目标：快速生成 3–7 日的旅游行程，偏好性价比高的餐饮与景点。
2. 家庭用户（带孩子，关注亲子友好、住宿便利与安全）
   - 目标：获得适合儿童的活动推荐与更合理的交通安排。
3. 团体/朋友（2–6 人，偏好主题活动，如美食/动漫）
   - 目标：生成包含多人偏好的行程并分配预算。
4. 重度旅行规划者/旅行顾问（需保存多份行程并导出）
   - 目标：管理多份行程、导出为共享链接或 PDF。

关键用户故事（示例）
- 作为一个用户，我希望用语音说出“我要去日本，5 天，预算 1 万元，喜欢美食和动漫，带孩子”，系统返回一份包含交通、住宿、景点与餐厅详细日程及费用估算的行程。
- 作为用户，我希望保存并云同步我的行程，以便在手机和电脑上查看与编辑。
- 作为用户，我希望记录实时开销（用语音或手动输入），并看到预算使用情况。

---

## 功能需求（按 MUST / SHOULD / COULD 优先级）

### MUST（必须）
1. 语音与文字输入：
   - 支持中文（普通话）语音识别与文字输入；语音识别按钮与连续/短句模式。
   - 显示语音转写、允许用户编辑文本后提交。
2. 智能行程生成（LLM 驱动）：
   - 接收目的地、日期、预算、人数、偏好（标签）等，返回结构化行程（按日/时间段划分）。
   - 行程包含：交通建议（含出发/到达方式、时间估计）、住宿建议（类型与大致价格区间）、景点与餐厅（含推荐理由、开放时间、门票/预订建议）、备用建议或不可行提示。
3. 预算与费用管理：
   - 基于行程生成预算估算（交通、住宿、餐饮、门票、杂费）。
   - 允许用户在行程中添加/编辑实际支出（语音或手动），并显示预算完成率与分类统计。
4. 用户管理与云同步：
   - 用户注册/登录（邮箱/密码 + OAuth 可选），支持保存多份行程，云端同步（数据模型：用户、行程、偏好、费用记录）。
5. 基本地图集成：
   - 在行程页嵌入地图视图（基于高德或百度地图 API），展示景点/住宿位置与线路。
6. 隐私与密钥管理：
   - 不在代码中保存 API key；提供设置页面允许用户输入/更新私有 API key（覆盖环境变量优先级说明），文档说明如何在本地/部署时注入密钥。
7. 部署与交付：
   - 提供 Dockerfile 并能构建运行；GitHub 仓库包含 README（运行步骤，包括如何注入 API keys）。

### 非必须（可选）
1. 语音合成（TTS）用于行程朗读或导航指示（例如：科大讯飞 TTS）。
2. 行程优化与约束满足：支持按用户约束（家庭友好、步行优先、预算上限等）再次优化行程。
3. 第三方连接：支持将住宿/航班推荐链接跳转到 OTA 平台（只做链接，不自动下单）。
4. 基本通知功能（行程变更提醒、价格波动警告）通过邮件或推送。
5. 实时价格比较（航班/酒店）并展示可预订选项（需额外 OTA API）。
6. 社交功能（评论/评分/行程公开库）。
7. 离线模式（缓存行程与地图瓦片）。
8. 更复杂的多人协同编辑与行程合并。
9. 导出与分享：导出行程为 PDF 与 JSON；生成可分享链接（只读或受控访问）。

---

## 页面与流程（信息架构 + 主要页面）

主要页面/组件（仅列出 MUST 功能对应页面）：
1. 首页 / 登录页
   - 介绍、特色功能、登录/注册入口、演示入口（体验版）。
2. 创建行程（输入界面）
   - 语音/文字输入控件（录音按钮、转写编辑区）、表单字段（目的地、出发/结束日期、预算、人数、偏好标签）、高级设置（偏好强度、儿童/无障碍需求）。
3. 行程生成结果页
   - 概览（总费用、总天数、亮点）、按日详细日程（时间段展开）、地图视图（路线与地点标注）、预算分解、修改与再生成功能。
4. 行程编辑器
   - 拖拽调整日程、添加/删除活动、自动重新计算时间与预算、手动添加费用。
5. 费用管理页
   - 支出记录（按分类）、图表（饼图/柱状）。
6. 我的行程（列表）
   - 行程卡片（预览、保存、删除）。
7. 设置页
   - 账户设置、API key 管理、偏好设置（默认出行人信息）。

关键流程示意
- 用户（可匿名体验）→ 输入需求（语音/文字）→ LLM 生成初稿 → 用户查看/编辑 → 保存到云端（需登录）→ 导出/分享/同步到移动设备。

---

## 数据模型（高层）
- User: id, email, displayName, authProvider, createdAt, preferences, apiKeysMeta (不保存密钥明文)
- Trip: id, userId, title, destination, startDate, endDate, participants, preferences, createdAt, updatedAt, status
- ItineraryItem: id, tripId, dayIndex, startTime, endTime, title, type(enum: travel/accommodation/attraction/restaurant/other), location{lat,lng,address}, notes, estimatedCost, bookedLink
- ExpenseRecord: id, tripId, itemId(optional), amount, currency, category, date, note, createdBy
- ActivityLog / Audit: change history for trip/item edits
- ShareLink: token, tripId, permissions, expiresAt

---

## 第三方集成点
- 语音识别 API：科大讯飞或其他（要求：中文语音识别，实时/短语识别）。
- 语音合成（可选）：科大讯飞或其他。
- 地图/地理编码/路线：高德地图或百度地图（展示地图、逆/正地理编码、路线规划）。
- 大语言模型（LLM）：OpenAI、Anthropic、Azure OpenAI、或自托管 LLM 服务（用于行程生成与预算估算）。
- 用户认证/数据库：Supabase / Firebase Authentication + Firestore / Supabase Postgres。
- 可选 OTA / 价格源：携程/去哪儿/Skyscanner 等（若实现价格比较功能）。
- CI/CD：GitHub Actions（用于构建 Docker 镜像并推送到阿里云容器仓库）。

安全与密钥管理要点
- 不要在代码或公开仓库中提交真实 API key。README 中说明如何用环境变量或配置页面注入 key。
- 在部署脚本/CI 中，使用 GitHub Secrets/阿里云镜像仓库的凭据来保护敏感信息。
- 对用户数据进行加密传输（HTTPS），敏感数据在存储端采取适当保护（例如：不存储明文第三方 key）。

---

## 非功能需求（NFR）

性能
- 页面首次可交付时间（TTFB/First Contentful Paint）目标：桌面 < 1.5s（理想），移动 < 2.5s（在良好网络下）。
- LLM 生成响应：首轮草稿 <= 8s（视 API），若超时显示“生成中”并提供进度提示。
可用性与可访问性
- 支持键盘导航，满足 WCAG 2.1 AA（至少实现键盘可操作与语义性标签）。
- 字体与颜色对比符合可访问性要求。
 
可扩展性
- 后端以微服务或模块化方式组织：行程服务、用户服务、支付/第三方代理服务等，便于替换 LLM 或地图服务。
可靠性
- 提供错误回退策略（如 LLM 超时则使用简化规则引擎），记录错误以便运维。
合规/隐私
- 遵守相关隐私法规（在所针对地区），提供隐私策略、用户数据删除/导出机制。

---

## 可用性与验证（验收标准）

每条 MUST 功能需通过自动化或手动测试：
1. 语音输入：
   - 能正确录入并转写 5 条不同的中文语音示例（普通话，含数字/地名），转写准确率达到可编辑可用。
2. 行程生成：
   - 针对示例输入（见用户故事），生成的行程包含交通、住宿、景点、餐饮与预算估算（至少 80% 完整性）。
3. 云同步：
   - 在电脑端保存行程，登录同一账号后能在手机端看到相同数据。
4. 费用管理：
   - 添加支出后能及时反映在预算统计并在导出 CSV 中显示。
5. 部署：
   - 提供 Docker 镜像，运行后基本服务（前端静态与后端 API）可访问。

验收测试包括：端到端用户流程测试、单元/集成测试（后端核心逻辑）、基本安全扫描与依赖检查。

---

---

## 测试策略（高层）
- 单元测试：后端核心逻辑（行程合成、预算计算）的单元测试覆盖率目标 60%+（MVP）。
- 集成/端到端（E2E）：关键流程（登录、行程生成、保存、导出）使用 Playwright / Cypress 自动化测试。
- 手动测试清单：语音转写精度、多设备同步、导出格式检查、分享链接权限测试。
- CI：在 GitHub Actions 中运行测试、构建 Docker 镜像、运行轻量静态检查（lint）。

---

## 可追踪的接受测试（举例）
- 用例 UT-01（智能行程生成）：
  - 输入：目的地=“东京”，日期=“2025-12-01 至 2025-12-05”，预算=10000 元，偏好=["美食","动漫"], 人数=2，备注：带孩子。
  - 期望：生成 5 天行程，包含至少 3 个餐厅推荐、至少 2 个适合孩子的活动、预算估算分项显示。
- 用例 UT-02（语音录入转写）：
  - 提供 10 秒普通话语音，“我要去大阪，4 天，预算 8000，喜欢购物和温泉”；
  - 期望：转写文本匹配（可手动编辑）并触发行程生成。

---

## UI/UX 指南（高层）
视觉风格
- 主题：清新、友好、旅游感（主色建议：蓝/绿渐变或机场航空蓝）；
- 界面要以地图与行程卡片为核心，排版清晰，按钮显著。
交互
- 语音录入按钮需明显并在录音时给出视觉反馈（波形或录音计时）。
- 在行程生成过程中显示进度指示器与可取消按钮。
- 可对行程项进行拖拽排序与时间调整（桌面），移动端可通过长按进入编辑模式。

文案语气
- 友好、清晰、提供建议性语言（例如：“建议在第 2 天上午安排 XX，因周末通常人流较大”）。

---

## 隐私与合规（高层）
- 在用户注册与设置中展示隐私政策与数据使用说明。
- 明确说明：不会公开用户的 API keys；第三方 API 调用将串联到用户提供的 key（或后端服务的 key，视实现）。

---

---

## 风险与缓解
1. 语音识别准确度不足（方言/噪音）：提供文本编辑回退、降噪引导、提高提示语引导用户说清楚。
2. LLM 生成不准确或事实性错误：在输出中标记信息可信度，提供“验证来源”或“替代建议”，并允许用户手动调整。
3. 第三方 API 限额或费用：在 README 和设置中提醒用户 key 使用限制，支持切换备用服务。
4. 时间/预算不足：优先实现核心 MUST 功能，后续迭代实现附加功能（TTS、实时价格比较）。

---

## 交付清单（检查项）
- [ ] 完成并通过验收的 MUST 功能实现
- [ ] README：包含运行、密钥注入、测试与 Docker 使用说明
- [ ] Dockerfile + CI 脚本（GitHub Actions）
- [ ] 导出 PDF 示例与演示数据
- [ ] 基本测试套件（单元 + E2E）
- [ ] 隐私政策示例文档

---

## 附录 — 关于 API key 与作业提交说明
- 强烈建议：在代码中仅保留配置键名（如 process.env.XFY_KEY），不要写入真实值；在 README 中说明如何将 key 通过环境变量或设置页面注入。
- 作业提交（按用户要求）：
  1. GitHub 仓库地址（含提交记录）。
  2. README 中说明如何构建 Docker 镜像与运行容器。
  3. 提供可下载的 Docker 镜像（或镜像仓库地址），并在 README 中说明演示用 API key 的位置与有效期（若提供）。
  4. 如果不使用助教提供的阿里云 key，请在 README 中提供你用于测试的 key，并确保在助教评阅的 3 个月内有效；但仍强烈建议把 key 放在私有渠道或仅在 README 中提供说明（并尽快撤销/更换）。

---

*文档生成于 2025-10-28*
